//>>built
define("epi-cms-addons-blocks/OptimizingBlock/viewmodel/VariationsViewModel",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","dojo/when","dojo/has","epi/dependency","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel","epi-cms/contentediting/viewmodel/ContentAreaViewModel"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b){return _2([_b],{dynamicDataStore:null,orderBy:{column:"boostValue",order:"desc"},constructor:function(){this.inherited(arguments);this.dynamicDataStore=this.dynamicDataStore||_8.resolve("epi.storeregistry").get("epi.cms.addons.optimizingblock");},createModel:function(_c){var _d=_c;if(!(_c instanceof _9)&&!(_c instanceof _a)){_d=new _9(_c);this.addChild(_d);}return _d;},setContentModel:function(_e){var _f=new _4();this.set("contentModel",_e);_6(this._updateStatisticInfoForModel(),_3.hitch(this,function(){this._sort();_f.resolve();}));return _f;},_sort:function(){if(!this.orderBy||!this.orderBy.column){return;}if(!this.orderBy.order){this.orderBy.order="desc";}var _10=this.orderBy.column,_11=this.orderBy.order.toString().toLowerCase()==="desc",_12=this,map=[],_13=[],_14=false;function _15(a,b){if(_7("ie")&&(a.value==b.value)){return 0;}return a.value>b.value?1:-1;};function _16(a,b){return _15(a,b);};function _17(a,b){return _15(b,a);};map=_1.map(this._data,function(_18,_19){return {value:_18.statisticInfo?parseFloat(_18.statisticInfo.boostValue):-1,index:_19};});if(_11){map.sort(_17);}else{map.sort(_16);}_13=_1.map(map,function(_1a){return _12._data[_1a.index];});_1.some(map,function(_1b,_1c){_14=_1b.index!=_1c;return _14;});if(_14){this._data=_13;this._emitChildrenOrderingChanged();}},_emitChildrenOrderingChanged:function(_1d){this.emit("childrenOrderChanged",_1d?_1d:this);},_updateStatisticInfoForModel:function(){var _1e=this;function _1f(_20){var _21=_1e.getChildren();if(_21&&_21.length>0){for(var i=0;i<_21.length;i++){_21[i].set("statisticInfo",_20[i]);}}};return this._updateStatisticInfo(null,_1f);},_updateStatisticInfo:function(_22,_23){var dfd=new _4();var _24={contentLink:this.contentModel.get("icontent_contentlink"),variantReferences:_1.map(this.getChildren(),function(_25){return _25.contentLink;}),variantContentLink:_22?_22.contentLink:null};_6(this.dynamicDataStore.query(_24),function(_26){_23.call(this,_26);dfd.resolve();});return dfd;}});});