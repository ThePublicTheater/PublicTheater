var syosDispatch = _(Backbone.Events).clone(), syosLogRender, syosTestModeActive; if (location.href.match(/logevents/)) { console.warn("EVENT LOGGING ON"); syosDispatch.on("all", function (n) { console.groupCollapsed("syosDisptach triggered %o", n); console.log("Arguments: %o", arguments); console.trace(); console.groupEnd() }) } syosLogRender = !!location.href.match(/logrender/); syosLogRender && console.warn("RENDER LOGGING ON"); typeof FlashCanvas != "undefined" && FlashCanvas.setOptions({ turbo: !1, delay: 30 }), function (n, t, i) { syosTestModeActive = !1; var r = function (n) { return new SYOSCore(n) }, u = function () { return this }, f = function (n, t) { var t = t || "(no message provided)"; if (!n) throw "SYOS: Failed BoolCheck! " + t; }; r.Error = function (n) { this.name = "SYOSError"; this.message = n }; r.Error.prototype = Error.prototype; r.Error.printXHRInfo = function () { console.group("%cSYOS XHR Error Details", "color:red;"); var n = arguments[0], t = JSON.parse(n.responseText); i(t).each(function (n, t) { console.group(t); console.log(n); console.groupEnd() }); console.log("error detail: %o", n); console.groupEnd() }; r.Errors = { rootDataAjax: function () { r.Error.printXHRInfo.apply(null, arguments); throw new r.Error("service call for root data failed"); }, reserveSeatsAjax: function () { r.Error.printXHRInfo.apply(null, arguments); throw new r.Error("service call for reserve seats failed!"); }, zonePriceAjax: function () { r.Error.printXHRInfo.apply(null, arguments); throw new r.Error("service call for zone prices failed"); }, alreadyOnPerformance: function (n) { console.warn("Aready on performance!"); console.log("Current Performance: %o", n.toJSON()) } }; r.Geometry = function () { var n = SYOSModel.extend({ defaults: { x: 0, y: 0 }, addX: function (n) { var t = this.get("x"); t += n; this.set("x", t) }, addY: function (n) { var t = this.get("y"); t += n; this.set("y", t) } }); return { Coordinates: n } }(); r.Elements = function () { var t = SYOSView.extend({ initialize: function () { this.on("didRender", this.didRender, this); this.didLoadView && this.didLoadView() }, didRender: u }), f = t.extend({ className: "syos-cart-wrapper", initialize: function () { this.isExpanded = !1; this.seats = new SYOSSeatCollection; this.seats.on("add", this.didAddSeat, this); this.seats.on("remove", this.didRemoveSeat, this); syosDispatch.on("buymode:addSeatToCart", this.didAddSeatToCart, this); syosDispatch.on("buymode:removeSeatFromCart", this.didRemoveSeatFromCart, this); syosDispatch.on("buymode:clearCart", this.shouldClearCart, this); syosDispatch.on("buymode:shouldRemoveSeatsOfType", this.shouldRemoveSeatsOfType, this); this.$el.bind("mousewheel", i(this.stopProp).bind(this)); r.Elements.View.prototype.initialize.apply(this, arguments) }, events: { "click [data-bb-event='remove']": "didClickRemove", "click [data-bb='expandButton']": "didClickExpand", "click [data-bb='reserveButton']": "didClickReserve", "click [data-bb-event='info']": "didClickInfo" }, didAddSeatToCart: function (n) { this.seats.add(n); syosDispatch.trigger("buymode:didChangeCart", this) }, didRemoveSeatFromCart: function (n) { this.seats.remove(n); n.set("IsInCart", !1); n.mapCircle.set("inCart", !1); n.mapCircle.set("underCursor", !1); syosDispatch.trigger("buymode:didChangeCart", this) }, didAddSeat: function (n) { console.log("Cart - adding seat: %o", n); n.set("IsInCart", !0); n.set("IsSelected", !1); this.render() }, didClickInfo: function (n) { this.modal && this.modal.close(); var t = this.getChildElementSeatId(n.currentTarget), i = this.seats.get(t) || this.exchangeSeats.get(t); this.modal = new SYOSModal({ CanDismiss: !0, Title: i.seatType.get("Description"), Content: i.seatType.get("FullPrompt") }) }, didRemoveSeat: function (n) { console.log("Cart - removing seat: %o", n); n.set("IsInCart", !1); n.set("IsSelected", !1); this.render() }, didClickRemove: function (n) { var t = this.getChildElementSeatId(n.currentTarget), i = this.seats.get(t) || this.exchangeSeats.get(t); syosDispatch.trigger("buymode:removeSeatFromCart", i) }, didClickExpand: function () { this.isExpanded = !this.isExpanded; this.render() }, didClickReserve: function (n) { n.preventDefault(); syosDispatch.trigger("buymode:reserveSeats") }, didRender: function () { this.determineVisibility() }, shouldClearCart: function () { this.seats.reset(); syosDispatch.trigger("buymode:didChangeCart", this); this.render() }, shouldRemoveSeatsOfType: function (n) { this.seats.each(function (t) { t.seatType.id === n && syosDispatch.trigger("buymode:removeSeatFromCart", t) }, this) }, getTotalSeats: function () { return this.seats.length }, getAllSeats: function () { return this.seats.models }, getChildElementSeatId: function (t) { var i = n(t).parents("[data-seat-id]")[0], r; return i && (r = i.getAttribute("data-seat-id")), parseInt(r, 10) || 0 }, determineVisibility: function () { var n = this.getTotalSeats(); n === 0 ? this.$el.fadeOut() : this.$el.show() } }); return { View: t, Cart: f } }(); r.Exchange = function () { var f = SYOSView.extend({ initialize: function () { this.cart = new u; this.el.querySelector(".syos-root").appendChild(this.cart.el); this.exchangeZones = new n; this.addonZones = new n; syosDispatch.on("map:seatSelected", this.didSelectSeat, this); syosDispatch.on("canvas:didClickSeat", this.didSelectSeat, this) }, didSelectSeat: function (n) { var t = n.PriceCollection.length; if (t !== 1) throw "SYOS Error: exchange mode does not support multiple price types"; else n.activePrice = n.PriceCollection.at(0), syosDispatch.trigger("buymode:addSeatToCart", n) }, loadLevelData: function (n) { var t = i(n.AllSeatPricing).map(function (n) { var t = i(n.Value["0"]).clone(); return t.ZoneId = parseInt(n.Key), t }), r = i(n.AddOnSections).map(function (n) { var t = i(n).omit("SectionId"); return t.ZoneId = n.SectionId, t }); this.exchangeZones.add(t); this.addonZones.add(r) } }), t = SYOSModel.extend({ idAttribute: "ZoneId" }), n = SYOSCollection.extend({ model: t }), u = r.Elements.Cart.extend({ template: Handlebars.templates["exchangeCart.html"], didLoadView: function () { this.exchangeSeats = new SYOSSeatCollection; this.exchangeSeats.on("add", this.didAddSeat, this); this.exchangeSeats.on("remove", this.didRemoveExchangeSeat, this); this.seatElements = {}; this.$el.hide(); this.render() }, didAddSeatToCart: function (n) { this.isExchangeCartFull() ? this.seats.add(n) : this.exchangeSeats.add(n) }, didRemoveExchangeSeat: function (n) { if (this.seats.length !== 0) { var t = this.seats.first(); this.exchangeSeats.add(t); this.seats.remove(t) } this.didRemoveSeat(n) }, didRemoveSeatFromCart: function (n) { console.log("Exchange Cart: removing seat: %o", n); this.seats.remove(n); this.exchangeSeats.remove(n) }, shouldClearCart: function () { this.seats.reset(); this.exchangeSeats.reset(); this.render() }, getAllSeats: function () { return i.union(this.exchangeSeats.models, this.seats.models) }, getExchangeCount: function () { return this.syos.settings.get("exchangeCount") || 0 }, getTotalSeats: function () { return this.exchangeSeats.length + this.seats.length }, getExchangePricing: function (n) { var i = parseInt(n.get("ZoneId"), 10), t = this.syos.exchangeMode.exchangeZones.get(i); return t ? t.toJSON() : undefined }, getAddonPricing: function (n) { var i = parseInt(n.get("ZoneId"), 10), t = this.syos.exchangeMode.addonZones.get(i); return t ? t.toJSON() : undefined }, isExchangeCartFull: function () { return this.exchangeSeats.length > this.getExchangeCount() - 1 }, hasDowngradeSeat: function () { return this.exchangeSeats.any(function (n) { return n.activePrice.get("Price") < 0 }) }, viewModel: function () { var u = !this.isExpanded && this.getTotalSeats() > 5, n = this.exchangeSeats.map(this.viewModelForExchangeSeat, this), t = this.seats.map(this.viewModelForAddonSeat, this), r = function (n, t) { var i = t.pricing.Price; return i < 0 && (i = 0), n + i }, f = i(n).reduce(r, 0) + i(t).reduce(r, 0); return n.reverse(), t.reverse(), { showExpandButton: u, isExpanded: this.isExpanded, exchangeSeats: n, seats: t, total: f } }, viewModelForAddonSeat: function (n) { var t = n.toJSON(); return i(t).extend({ exchange: !1 }), i(t).extend({ pricing: this.getAddonPricing(n), info: n.seatType.toJSON() }), t }, viewModelForExchangeSeat: function (n) { var t = n.toJSON(); return i(t).extend({ exchange: !0 }), i(t).extend({ pricing: this.getExchangePricing(n), info: n.seatType.toJSON() }), t } }); return { Purchasing: f, Zone: t, ZoneCollection: n, ExchangeCart: u } }(); r.Data = {}; r.Data.Services = SYOSView.extend({ serviceRoot: "/SYOSService/SYOSService.asmx", defaultOptions: i(function () { return { contentType: "application/json", responseType: "application/json", type: "post", success: i(this.defaultSuccess).bind(this), error: i(this.defaultError).bind(this) } }).memoize(), defaultSuccess: function (n) { console.log(n) }, defaultError: function (n) { console.log(n) }, makeRequest: function (t, r) { var u = i(r).defaults(this.defaultOptions()); i(u).extend({ url: t }); console.groupCollapsed("%cData request to %s with options", "color:#670099; font-weight:bold", t); console.log("XHR Options: %o", u); console.groupEnd(); n.ajax(u) }, reserveSeats: function (n) { this.makeRequest(this.serviceRoot + "/ReserveSeats", n) }, getRootConfigData: function (n) { this.makeRequest(this.serviceRoot + "/GetRootConfigData", n) } }); r.Buymode = function () { var f = SYOSView.extend({ initialize: function () { this.initCart(); this.seatPopup = new u; syosDispatch.on("global:levelInformationLoaded", this.didLoadLevelInfo, this) }, initCart: function () { this.cart = new t; this.getBBElement("syosRoot").appendChild(this.cart.el) }, didLoadLevelInfo: function (n) { return this.Level = new SYOSLevel, this.Level.loadLevel(n), syosDispatch.trigger("buymode:ensureMapAccuracy", _this), this }, didChangeExchangeSeatCount: function (n) { console.log("SYOS: Changing exchange count to %s", n); this.exchangeCount = n }, reserveSeatResults: function (n) { return console.log("reserve seats results", n), this }, reserveSeatError: function (t) { var e = this, f, r, u, o, s; return syosDispatch.trigger("hideLoadingMessage"), t._message && (f = n("script[type='text/reserve-error-template']"), r = i.detect(f, function (i) { var r = n(i).attr("data-error-string"), u = t._message.indexOf(r); if (u !== -1) return !0 }), console.groupEnd(), r = r ? n(r) : n("#reserve-error-general"), console.log("Error Template", r), u = r.attr("data-action"), o = function () { HtmlSyos.restart() }, u && u === "dismiss" && (u = function (n) { n.close() }), s = new SYOSModal({ CanDismiss: !1, Title: r.attr("data-error-title"), Content: r.html(), Width: 60, Height: 35, Actions: [{ ButtonText: r.attr("data-button-text"), Fn: u }] })), console.log(t), e } }), t = r.Elements.Cart.extend({ template: Handlebars.templates["cart.html"], viewModel: function () { var t = this.seats.length > this.syos.settings.get("maxCartLength"), n = this.seats.map(this.viewModelForSeat, this), r = i(n).reduce(function (n, t) { return n + t.pricing.Price }, 0); return { isExpanded: this.isExpanded, showExpandButton: t, seats: n, total: r } }, viewModelForSeat: function (n) { var t = n.toJSON(); return i(t).extend({ pricing: n.getActivePrice().toJSON() }), i(t).extend({ info: n.seatType.toJSON() }), t } }), u = SYOSView.extend({ id: "seatPopupView", className: "syos-seat-popup-view", template: Handlebars.templates["popup.html"], initialize: function () { this.position = new r.Geometry.Coordinates; this.faded = !1; this.shown = !1; n("#syos").prepend(this.$el); this.$el.hide(); syosDispatch.on("canvas:didClickSeat", this.didSelectSeat, this); syosDispatch.on("keyboard:escape", this.closePopup, this); syosDispatch.on("map:willDrag", this.willDragMap, this); syosDispatch.on("map:dragged", this.didDragMap, this); syosDispatch.on("control:smartZoom", this.movePopupToActiveSeat, this) }, events: { "click .syos-popup-addToCart": "addButtonClicked", "click .syos-popup-closeButton": "closePopup" }, didDragMap: function () { this.movePopupToActiveSeat(); this.unfadePopup() }, willDragMap: function () { this.fadePopup() }, didSelectSeat: function (n) { if (this.activeSeat && this.clearSeatSelectedState(), n.get("IsInCart")) return syosDispatch.trigger("buymode:removeSeatFromCart", n), !0; this.activeSeat = n; this.activeSeat.mapCircle.set("selected", !0); this.render(); var t = this.activeSeat.PriceCollection.length; t === 1 ? (this.addActiveSeatWithPriceIndex(0), this.closePopupImmeadiate()) : t === 0 && (this.closePopupImmeadiate(), alert("No Pricing Available for this Seat")) }, clearSeatSelectedState: function () { this.activeSeat && (this.activeSeat.set({ IsSelected: !1 }), this.activeSeat.mapCircle.set("selected", !1)) }, render: function () { this.el.innerHTML = this.template(this); this.openPopup(); this.movePopupToActiveSeat() }, getActiveSeatPosition: function () { var n, i, t; return this.activeSeat ? (i = this.activeSeat.mapCircle, t = this.activeSeat.mapCircle.scaledAttributes().radius, n = this.syos.canvasMap.getPositionForCircle(i), n.x += t, n.y += t) : n = { x: 0, y: 0 }, n }, getCurrentPosition: function () { return { x: parseFloat(this.$el.css("left")), y: parseFloat(this.$el.css("top")) } }, movePopupToActiveSeat: function () { var n = this.getActiveSeatPosition(), t = { top: n.y + "px", left: n.x + "px" }; this.shown ? this.$el.animate(t, { duration: 300, easing: "easeOutSine" }) : this.$el.css(t) }, openPopup: function () { this.shown = !0; this.$el.show(); this.faded && this.unfadePopup() }, closePopup: function () { this.clearSeatSelectedState(); this.shown = !1; syosDispatch.trigger("buymode:seatInfoClosed", this.activeSeat); this.$el.hide("drop", { duration: 300, easing: "easeInSine", direction: "down" }) }, closePopupImmeadiate: function () { this.$el.css("display", "none"); this.closePopup() }, fadePopup: function () { this.faded = !0; var n = { opacity: .5 }; this.shown ? this.$el.animate(n) : this.$el.css(n) }, unfadePopup: function () { this.faded = !1; var n = { opacity: 1 }; this.shown ? this.$el.animate(n) : this.$el.css(n) }, addActiveSeatWithPriceIndex: function (n) { this.activeSeat.trigger("setActivePrice", n); this.activeSeat.set({ IsInCart: !0 }); syosDispatch.trigger("buymode:addSeatToCart", this.activeSeat) }, addActiveSeatToCart: function () { }, addButtonClicked: function (t) { var i = n(t.currentTarget), r = i.parents("tr").index(); this.addActiveSeatWithPriceIndex(r); this.closePopup() } }), e = SYOSView.extend({ className: "syos-reserve-dialog-wrap", template: Handlebars.templates["reserveDialog.html"], initialize: function () { SYOSView.prototype.initialize.apply(this, arguments); this.seats = new SYOSSeatCollection; syosDispatch.on("buymode:reserveSeats", this.shouldReserveSeats, this); this.postReserveActions = []; this.close(); this.render() }, events: { "click [data-bb='reserveCancel']": "didClickReserveCancel", "click [data-bb='reserveConfirm']": "didClickReserveConfirm" }, addPostReserveAction: function (n) { this.postReserveActions.push(n) }, didClickReserveCancel: function () { this.syos.settings.get("seatTypeWarningRemoveSeatsOnCancel") && syosDispatch.trigger("buymode:shouldRemoveSeatsOfType", this.currentWarningSeatType.get("ID")); this.close() }, didClickReserveConfirm: function () { this.confirmPrompt = null; this.render(); this.sendReserveRequest() }, shouldReserveSeats: function () { this.reset(); this.seats.add(this.syos.primaryCart.getAllSeats()); console.log("Reserving with seats: %o", this.seats); this.open(); this.syos.settings.get("reserveConfirm") ? this.showSeatTypeWarning() : this.sendReserveRequest() }, getReserveString: function () { var n = ""; return this.seats.each(function (t) { n += t.get("SeatNumber") + "," + t.activePrice.get("PriceTypeId") + "," + t.get("SeatType") + ";" }), n }, setAjaxString: i(function (n) { this.getBBElement("reserveAjax").innerText = n }).throttle(1e3), showSeatTypeWarning: function () { var i = new SYOSSeatTypeCollection, n, t; this.seats.each(function (n) { i.add(n.seatType) }); n = i.first(); t = n.get("ConfirmPrompt"); t ? (this.currentWarningSeatType = n, this.confirmPrompt = { dialogText: t, cancelButtonText: this.syos.settings.get("seatTypeWarningModalCancelText"), confirmButtonText: this.syos.settings.get("seatTypeWarningModalConfirmText") }, this.render()) : this.sendReserveRequest() }, open: function () { this.dialogEl.style.display = "none"; this.el.style.display = "block"; n(this.dialogEl).show("clip") }, close: function () { this.el.style.display = "none" }, didRender: function () { this.dialogEl = this.getBBElement("reserveDialog") }, reset: function () { this.seats.reset(); this.confirmPrompt = null; this.errorPrompt = null; this.render() }, viewModel: function () { var n = !0; return (this.confirmPrompt || this.errorPrompt) && (n = !1), { seats: this.seats, showWait: n, confirmPrompt: this.confirmPrompt, errorPrompt: this.errorPrompt } }, showErrorForMessage: function (t) { var t = t.toLowerCase(), r = "reserve-error-general", u, f; i(n('script[type="text/reserve-error-template"]')).each(function (n) { var i = n.getAttribute("data-error-string").toLowerCase(), u = new RegExp(t), f = !!i.match(u); f && (r = n.id) }); console.log("selected error template: " + r); u = document.querySelector("#" + r); f = n(u).html(); this.errorPrompt = { title: u.getAttribute("data-error-title"), content: f }; this.render() }, sendReserveRequest: function () { var n = this.getReserveString(), t = { seatString: n, itemNumber: this.syos.performance.id, syosType: this.syos.syosType }, r = { data: JSON.stringify(t), beforeSend: i(this.reserveSend).bind(this), error: i(this.reserveError).bind(this), success: i(this.reserveSuccess).bind(this) }; return this.syos.services.reserveSeats(r), this }, reserveSend: function () { this.setAjaxString("Sending..."); this.blockRedirect = !1 }, reserveError: function (n) { var t = JSON.parse(n.responseText); this.setAjaxString("Error reserving seats."); console.log("Error reserving seats: %o", t); this.showErrorForMessage(t.Message); i(r.Errors.reserveSeatsAjax).bind(this) }, reserveSuccess: function (n) { syosDispatch.trigger("buymode:reserveSuccess"); this.redirect = n.d; var t = i.bind(function () { console.log("SYOS PostReserveAction Complete, Redirecting..."); this.setAjaxString("Redirecting..."); this.doRedirect() }, this), r = i.after(this.postReserveActions.length, t); i(this.postReserveActions).invoke("then", r) }, doRedirect: function () { this.windowObject ? this.pageRedirect(this.windowObject) : this.pageRedirect(window) }, pageRedirect: function (n) { i(function () { n.location.href = this.redirect }).chain().bind(this).delay(500) }, useWindowObject: function (n) { this.windowObject = n } }); return { Controller: f, Cart: t, SeatPopup: u, ReserveDialog: e } }(); r.Touch = function () { var n = function (n) { this.el = n.el; this.syos = SYOSView.prototype.syos; this.initListeners() }; return n.prototype = { initListeners: function () { Hammer(this.el).on("pinch", i(this.didPinch).bind(this)); Hammer(this.el).on("doubletap", i(this.didDoubleTap).bind(this)); Hammer(this.el).on("drag", i(this.didDrag).bind(this)); Hammer(this.el).on("dragstart", i(this.didDragStart).bind(this)); Hammer(this.el).on("dragend", i(this.didDragEnd).bind(this)) }, didPinch: i(function (n) { var t, i; n.preventDefault(); n.stopPropagation(); n.gesture.preventDefault(); n.gesture.stopPropagation(); t = n.gesture; syosDispatch.trigger("touch:didPinch", n.gesture, n); var r = this.syos.utility.getCurrentZoom(), f = r * t.scale, u = f - r; u *= this.syos.settings.get("touchZoomFactor"); i = { x: this.syos.utility.getTouchAverageForKey(t.touches, "clientX"), y: this.syos.utility.getTouchAverageForKey(t.touches, "clientY") }; syosDispatch.trigger("control:smartZoom", u, i.x, i.y); this.lastPinchCenter = t.center }).debounce(500), didDoubleTap: function (n) { n.preventDefault(); n.stopPropagation(); var t = n.gesture; syosDispatch.trigger("touch:didDoubleTap", n.gesture) }, didDrag: function (n) { var t, i, r; return n.preventDefault(), n.stopPropagation(), n.gesture.preventDefault(), n.gesture.stopPropagation(), t = n.gesture, syosDispatch.trigger("touch:didDrag", n.gesture), i = this.lastDragCenter.pageX - t.center.pageX, r = this.lastDragCenter.pageY - t.center.pageY, syosDispatch.trigger("control:smartMove", i, r), this.lastDragCenter = t.center, !1 }, didDragStart: function (n) { n.preventDefault(); n.stopPropagation(); n.gesture.preventDefault(); n.gesture.stopPropagation(); var t = n.gesture; return syosDispatch.trigger("touch:didDragStart", n.gesture), this.lastDragCenter = t.center, !1 }, didDragEnd: function (n) { n.preventDefault(); n.stopPropagation(); n.gesture.preventDefault(); n.gesture.stopPropagation(); var t = n.gesture; return syosDispatch.trigger("touch:didDragEnd", t), !1 }, getDefaultCenter: function () { return { pageX: 0, pageY: 0 } } }, n }(); r.Keyboard = function () { var t = SYOSView.extend({ initialize: function () { this.active = !1; n(document).on("keydown", i(this.didKeyup).bind(this)) }, events: { mouseover: "didMouseOver", mouseout: "didMouseOut" }, didMouseOver: function () { this.active = !0 }, didMouseOut: function () { this.active = !1 }, didKeyup: function (n) { if (this.active) { var t = n.keyCode.toString(); t in this.keycodeAliases && (t = this.keycodeAliases[t]); t in this.keycodeActions && this.keycodeActions[t].apply(this, [n]) } }, keycodeAliases: { "107": "187", "109": "189" }, keycodeActions: { "37": function (n) { n.preventDefault(); n.returnValue = !1; syosDispatch.trigger("control:moveLeft") }, "38": function (n) { n.preventDefault(); n.returnValue = !1; syosDispatch.trigger("control:moveUp") }, "39": function (n) { n.preventDefault(); n.returnValue = !1; syosDispatch.trigger("control:moveRight") }, "40": function (n) { n.preventDefault(); n.returnValue = !1; syosDispatch.trigger("control:moveDown") }, "187": function () { var n = this.syos.settings.get("ZoomIncrement"); syosDispatch.trigger("control:smartZoom", n, null, null) }, "189": function () { var n = -1 * this.syos.settings.get("ZoomIncrement"); syosDispatch.trigger("control:smartZoom", n, null, null) } } }); return { Controller: t } }(); r.Display = function () { SYOSDisplay = SYOSModel.extend({ defaults: { InFullscreen: !1 }, initialize: function () { this.syos.display = this; this.Control = this.control = new SYOSControl; this.Keyboard = this.keyboard = new SYOSKeyboard; this.View = this.view = new SYOSDisplayView({ model: this }); this.LoadingView = this.loadingView = new SYOSLoadingView({ model: this }); syosDispatch.on("control:zoom", i(function (n) { n ? this.zoomIn() : this.zoomOut() }).bind(this)); syosDispatch.on("control:shouldOpenLevel", this.shouldOpenLevel, this); this.on("change:InFullscreen", i(function () { this.syos.settings.set({ InFullscreen: this.get("InFullscreen") }) }).bind(this)); syosDispatch.on("levelDidOpen", this.levelDidOpen, this) }, shouldOpenLevel: function (n) { syosDispatch.trigger("showLoadingMessage", { text: "Loading Level..." }); n.showLevel() }, levelDidOpen: function () { return syosDispatch.trigger("display:willShowMap"), this.view.toolsView && this.view.toolsView.present(), this }, shouldChangeLevels: function () { return syosDispatch.trigger("display:willShowLevelSelection"), this.view.toolsView && this.view.toolsView.dismiss(), this.view.levelSelection && this.view.levelSelection.present(), this }, zoomIn: function () { var n = this.syos.settings.get("ZoomIncrement"); syosDispatch.trigger("control:smartZoom", n) }, zoomOut: function () { var n = this.syos.settings.get("ZoomIncrement"); syosDispatch.trigger("control:smartZoom", -n) } }); SYOSDisplayView = SYOSView.extend({ __bbType: "SYOSDisplayView", template: Handlebars.templates["display.html"], initialize: function () { var r = this, t; this.setElement(document.getElementById("syos")); this.initColors(); this.initSeatViews(); this.initLegend(); this.initLevelMap(); this.HasAutoscrolled = !1; this.syos.config.touchMode && this.initTouch(); this.levelSwitch = new SYOSLevelSwitchView; syosDispatch.on("control:zoom", function () { r.attemptAutoscroll() }); syosDispatch.on("map:seatSelected", this.attemptAutoscroll, this); syosDispatch.on("control:toggleFullscreen", this.toggleFullscreen, this); syosDispatch.trigger("display:didInit", this); this.render(); t = i(this.sizeViewport).bind(this); n(window).resize(t); this.syos.settings.get("useAutoSizing") && n(window).off("resize") }, toggleFullscreen: function () { var t = this; return n("#syos").fadeOut(600, function () { n("#syos").toggleClass("fixedscreen"); n("#syos").toggleClass("fullscreen"); n("#syos").fadeIn(600, function () { t.model.get("InFullscreen") ? t.$el.find("[data-bb-event='toggle-fullscreen']").html("Close Fullscreen") : t.$el.find("[data-bb-event='toggle-fullscreen']").html("Fullscreen") }) }), t.model.set({ InFullscreen: !t.model.get("InFullscreen") }), t }, initSeatViews: function () { this.seatViews = new SYOSSeatViewLayer }, initColors: function () { return this.colors = new SYOSSeatColorCollection, this.colors.add(i(this.syos.rootData.SeatColors).values()), this }, initTouch: function () { this.touch = new r.Touch({ el: this.el }) }, initLevelMap: function () { var n = this.$el.find("#chooseLevel")[0]; this.syos.settings.get("levelSelectMap") && (this.levelSelection = new SYOSLevelSelectionView({ el: n }), this.initLevelSummary()) }, initLevelSummary: function () { this.levelSummary = new SYOSLevelSummary }, initToolsView: function () { this.toolsView && this.toolsView.remove(); this.toolsView = new SYOSToolsView({ el: this.$el.find("#syosTools")[0] }) }, events: { selectstart: "didStartSelect" }, didStartSelect: function (n) { return n.preventDefault(), this }, initLegend: function () { return this.legend = new SYOSLegend, this.legend.addSeatColors(this.colors), this.el.appendChild(this.legend.render().el), this }, attemptAutoscroll: function () { var t = this, i = n(window), u = this.$el.offset().top + this.$el.height(), f = i.scrollTop() + i.height(), r; f < u && t.HasAutoscrolled === !1 && (r = t.$el.offset().top * .9, n("body").animate({ scrollTop: r + "px" }), t.HasAutoscrolled = !0) }, centerOnScreen: function () { this.$el.css("position", "absolute"); this.$el.css("top", Math.max(0, (n(window).height() - this.outerHeight()) / 2 + n(window).scrollTop()) + "px"); this.$el.css("left", Math.max(0, (n(window).width() - this.outerWidth()) / 2 + n(window).scrollLeft()) + "px") }, loadLevelDropdown: function () { this.levelDropdown = new SYOSLevelDropdown }, sizeViewport: function () { var n = this.syos.utility.getCanvasHeight(); this.$el.find(".syos-canvas").css("height", n + "px") }, viewModel: function () { return { showLevelMap: this.syos.settings.get("levelSelectMap"), showToolsView: this.syos.settings.get("toolsMenu"), levelViews: this.syos.rootData.LevelViews, levelClass: this.getLevelClassName() } }, getLevelClassName: function () { var n = this.syos.performance.venue.get("name"); return n = n.split(" ")[0], n.toLowerCase() }, render: function () { SYOSView.prototype.render.apply(this, arguments); this.el.appendChild(this.legend.render().el); this.seatViews.setElement(this.$el.find("#seatsWrap")[0]); this.levelSwitch.setElement(this.$el.find("#changeLevel")[0]); this.levelSwitch.render(); var n = this.$el.find("#chooseLevel")[0]; return n && this.levelSelection.setElement(n), this.initToolsView(), this.levelSummary && (this.levelSummary.setElement(this.$el.find("#levelSummary")[0]), this.levelSummary.render()), this.levelDropdown && this.$el.find("#changeLevels").hide().after(this.levelDropdown.el), this.sizeViewport(), this } }); SYOSDisplaySubview = SYOSView.extend({ present: function () { return this.deactivated || this.$el.fadeIn(), this }, dismiss: function () { return this.$el.fadeOut(), this }, openLevel: function (n) { return syosDispatch.trigger("showLoadingMessage", { text: "Loading Level..." }), n.showLevel(), this }, deactivate: function () { this.deactivated = !0; this.dismiss() } }); SYOSControl = t.Model.extend({ initialize: function () { syosDispatch.on("scroll:up", function () { syosDispatch.trigger("control:zoom", !0) }); syosDispatch.on("scroll:down", function () { syosDispatch.trigger("control:zoom", !1) }) } }); SYOSKeyboard = SYOSModel.extend({ initialize: function () { var t = this; n(window).on("keyup", function (n) { t.sendEventForKeycode(n.keyCode) }); n(document).on("mousewheel", ".syos-canvas", i(function (n) { var t = this.syos.settings.get("ZoomIncrement"), i, r, u; n.preventDefault(); i = n.originalEvent.wheelDelta || -n.originalEvent.detail; i && i <= 0 && (t = -t); r = n.offsetX || n.originalEvent.layerX; u = n.offsetY || n.originalEvent.layerY; console.log("mouse xy not tap: " + r + ", " + u); syosDispatch.trigger("control:smartZoom", t, r, u) }).bind(this)) }, sendEventForKeycode: function (n) { var t; switch (n) { case 27: t = "escape"; break; case 37: t = "arrowLeft"; break; case 38: t = "arrowUp"; break; case 39: t = "arrowRight"; break; case 40: t = "arrowDown" } t && syosDispatch.trigger("keyboard:" + t) } }); SYOSToolsView = SYOSDisplaySubview.extend({ initialize: function () { var t = this; this.setElement(n("#syosTools")); this.syos.settings.get("showFullscreen") || this.$el.find('[data-bb-event="toggle-fullscreen"]').hide(); this.$el.find("#zoomSlider").slider({ value: this.syos.utility.getCurrentZoom(), orientation: "vertical", max: this.syos.settings.get("ZoomMax"), min: this.syos.settings.get("ZoomMin"), step: this.syos.settings.get("ZoomIncrement"), slide: function (n, t) { this.syos.settings.set({ CurrentZoom: t.value }) } }); this.$el.find("#zoomSlider").slider("value", this.syos.utility.getCurrentZoom()); syosDispatch.on("levelDidOpen", function (t) { t.SeatViews.length === 0 ? n("#toggleView").hide() : n("#toggleView").show() }); this.syos.settings.on("change:CurrentZoom", function () { t.$el.find("#zoomSlider").slider("value", this.syos.utility.getCurrentZoom()) }); return t }, events: { "click .zoomIn": "zoomIn", "click .zoomOut": "zoomOut", "click [data-bb-event='toggle-fullscreen']": "toggleFullscreen", "click [data-bb-event='toggle-seat-view']": "toggleSeatViews", "click #moveN": "moveUp", "click #moveE": "moveRight", "click #moveS": "moveDown", "click #moveW": "moveLeft" }, moveUp: function () { syosDispatch.trigger("control:moveUp") }, moveRight: function () { syosDispatch.trigger("control:moveRight") }, moveDown: function () { syosDispatch.trigger("control:moveDown") }, moveLeft: function () { syosDispatch.trigger("control:moveLeft") }, zoomIn: function () { syosDispatch.trigger("control:zoom", !0) }, zoomOut: function () { syosDispatch.trigger("control:zoom", !1) }, toggleFullscreen: function () { syosDispatch.trigger("control:toggleFullscreen") }, toggleSeatViews: function (n) { return syosDispatch.trigger("toggleSeatViews"), n.preventDefault(), this } }); SYOSLevelSwitchView = SYOSDisplaySubview.extend({ __bbType: "SYOSLevelSwitchView", template: Handlebars.templates["levelSwitch.html"], initialize: function () { this.listenTo(syosDispatch, "core:didChangeLevelPricing", this.didChangePricing, this); syosDispatch.on("display:willShowLevelSelection", this.dismiss, this); syosDispatch.on("display:willShowMap", this.present, this); syosDispatch.on("levelDidOpen", this.render, this) }, events: { "click [data-bb-event='change-levels']": "didClickChangeLevels", "change [data-bb='changeLevelSelect']": "didChangeLevelSelect" }, didChangeLevelSelect: function (n) { n.preventDefault(); var i = n.currentTarget.value, t = this.syos.levels.detect(function (n) { return n.get("LevelName") === i }); t && this.openLevel(t) }, didChangePricing: function () { console.log("Updating level selection prices..."); this.syos.display.view.levelSummary.render() }, didClickChangeLevels: function (n) { n.preventDefault(); this.syos.display.shouldChangeLevels() }, render: function () { this.el.innerHTML = this.template(this); var n = this.syos.activeLevel && this.syos.activeLevel.get("LevelName"); return this.$el.find("#changeLevelSelect").val(n || ""), syosDispatch.trigger("display:finishLevelSwitch"), this } }); SYOSLevelSelectionView = SYOSDisplaySubview.extend({ initialize: function () { syosDispatch.on("display:levelDidOpen", this.didOpenLevel, this); this.$el.bind("mousewheel", function (n) { n.stopPropagation() }) }, events: { "mouseenter area": "highlightLevel", "click area": "showLevel" }, didOpenLevel: function () { this.dismiss() }, highlightLevel: function (t) { var i = this, r = n(t.target).attr("href").replace("#level", ""); return n("#chooseCommand").fadeOut(150), n(".houseView_level" + r).show().siblings("img:not(#houseView)").hide(), i.$el.find("li").eq(r - 1).fadeIn(150).siblings().fadeOut(150), i }, showLevel: function (t) { var i = this, r, u, f; return t.preventDefault(), syosDispatch.trigger("showLoadingMessage", { text: "Loading Level..." }), r = n(t.currentTarget).index(), u = this.syos.rootData.LevelViews[r].LevelId, console.log("Showing level..."), f = this.syos.levels.detect(function (n) { return parseInt(n.get("LevelNumber"), 10) === u }), i.dismiss(), f.showLevel(), i } }); SYOSLoadingView = SYOSDisplaySubview.extend({ defaultOptions: { loadingText: "Loading...", showSeats: !0 }, initialize: function () { this.setElement(document.getElementById("syosLoading")); this.$el.hide(); syosDispatch.on("showLoadingMessage", this.handleLoadingMessageRequest, this); syosDispatch.on("hideLoadingMessage", this.hideLoadingMessage, this); return this }, hideLoadingMessage: function () { return this.dismiss(), n("#syos-full-loading").each(function () { n(this).hide() }), this }, handleLoadingMessageRequest: function (t) { return i(t).defaults(this.defaultOptions), this.$el.find("#syos-loading-text").text(t.text), this.present(), t.showSeats ? this.$el.find("img").show() : this.$el.find("img").hide(), n("#syos-full-loading").each(function () { n(this).show() }), this } }); SYOSModal = SYOSView.extend({ template: Handlebars.templates["modal.html"], defaultOptions: function () { return { CanDismiss: !0, Height: this.syos.settings.get("modalDefaultHeight"), Width: this.syos.settings.get("modalDefaultWidth") } }, initialize: function () { i.defaults(this.options, this.defaultOptions()); this.setElement(document.getElementById("syos-modal")); this.$overlay = n("#syos-modal-overlay"); this.render().show(); syosDispatch.on("keyboard:escape", this.close, this); return this }, events: { "click [data-bb-event='close']": "close", "click [data-bb-event='action']": "actionHandler", mousewheel: "stopProp" }, actionHandler: function (t) { var i = n(t.currentTarget).index(); return this.options.Actions ? this.options.Actions[i].Fn.call(null, this) : console.error("Actions are undefined for modal!"), this }, show: function () { return this.$overlay.fadeIn(), this.$el.fadeIn(), this }, close: function () { return this.$el.fadeOut(), this.$overlay.fadeOut(), this }, render: function () { this.el.innerHTML = this.template(this.options); var n = (100 - this.options.Height) / 2, t = (100 - this.options.Width) / 2; return this.$el.css({ width: this.options.Width + "%", height: this.options.Height + "%", top: n + "%", left: t + "%" }), this } }); SYOSSeatTooltip = SYOSView.extend({ className: "syos-seat-tooltip", positionAdjustment: { x: 0, y: 0 }, adjustCoordinates: function (n) { var t = i(n).clone(); return t.x += this.positionAdjustment.x, t.y += this.positionAdjustment.y, t.x < 0 && (t.x = t.x + 120), t.y < 0 && (t.y = t.y + 90), t }, positionToCircle: function (n) { var i = this.syos.canvasMap.getPositionForCircle(n), t = this.adjustCoordinates(i); this.$el.css({ top: t.y, left: t.x }) }, positionToSeat: function (n) { var t = n.mapCircle; this.positionToCircle(t) } }); SYOSLegend = SYOSView.extend({ className: "syos-legend", template: Handlebars.templates["legend.html"], initialize: function () { this.legendItems = new SYOSLegendItemCollection; this.legendItems.on("add remove change", this.render, this) }, addLegendItemWithColorAndText: function (n, t) { var n = n || "#000", t = t || "legend item text"; this.legendItems.add({ color: n, text: t }) }, addSeatColors: function (n) { var t = n.map(this.seatColorMapping, this); t = i(t).compact(); this.legendItems.add(t) }, viewModel: function () { return { items: this.legendItems.toJSON() } }, seatColorMapping: function (n) { var t = new SYOSLegendItem({ color: n.get("Color"), text: n.get("Description") }); if (n.get("Description")) return t }, reset: function () { this.legendItems.reset(); this.render() }, render: function () { return this.el.innerHTML = this.template(this.viewModel()), this } }); SYOSLegendItem = SYOSModel.extend({}); SYOSLegendItemCollection = SYOSCollection.extend({ model: SYOSLegendItem }); SYOSLevelSummary = SYOSView.extend({ __bbType: "SYOSLevelSummary", template: Handlebars.templates["levelSummary.html"], initialize: function () { this.syos.levels.on("change", this.render, this); return this.render(), this }, viewModel: function () { return this.syos.levels.map(function (n) { var t = n.toJSON(), r = n.get("LevelName").replace(/ /g, ""); return i(t).extend({ levelClassName: r, priceRangeString: n.priceRangeString() }), t }) } }); SYOSStatusView = SYOSView.extend({ __bbType: "SYOSStatusView", className: "syos-status-view", initialize: function () { this.shown = !1; this.hide(); this.statusElement = document.createElement("span"); this.el.appendChild(this.statusElement); this.statusElement.innerText = "Status Message"; syosDispatch.on("display:shouldUpdateStatus", this.shouldUpdateStatus, this) }, shouldUpdateStatus: function (n, t) { var t = t || 1e3; this.showStatus(); this.statusElement.innerText = n; this.setDelayedHide(t) }, setDelayedHide: function (n) { this.hideTimeout = setTimeout(i(this.hideStatus).bind(this), n) }, showStatus: function () { this.shown || (this.$el.show(), this.shown = !0) }, hideStatus: function () { this.shown && (this.$el.hide(), this.shown = !1) } }); SYOSSeatViewLayer = SYOSView.extend({ initialize: function () { this.seatViewIcons = []; this.showing = !1; syosDispatch.on("levelDidOpen", this.hideSeatViews, this); syosDispatch.on("toggleSeatViews", this.toggleSeatViews, this) }, toggleSeatViews: function () { return this.showing ? this.hideSeatViews() : this.showSeatViews(), this }, showSeatViews: function () { return this.showing = !0, this.syos.activeLevel.seatViews.each(function (n) { this.el.appendChild(this._createIconFromView(n).el) }, this), this }, hideSeatViews: function () { return this.showing = !1, i(this.seatViewIcons).each(this._removeSeatViewIcon, this), this }, _removeSeatViewIcon: function (n) { this.seatViewIcons = i(this.seatViewIcons).without(n); n.remove() }, _createIconFromView: function (n) { var t = new SYOSSeatViewIcon({ model: n }); return this.seatViewIcons.push(t), t } }); SYOSSeatViewIcon = SYOSView.extend({ tagName: "img", className: "syos-seat-view-icon", events: { click: "showSeatView" }, initialize: function () { var n = this.syos.utility.getCurrentZoom(); this._position(); syosDispatch.on("map:didUpdateState", this._position, this); syosDispatch.on("control:smartZoom", this._position, this); syosDispatch.on("control:smartMove", this._position, this); syosDispatch.on("map:dragged", this._position, this); syosDispatch.on("map:willDrag", this.fadeOut, this) }, _position: function () { var n = this.syos.utility.scaleCoordinates(this.model.get("X"), this.model.get("Y")), t = this.syos.canvasMap.getCircleMapOffset(); n.x += t.x; n.y += t.y; this.el.setAttribute("src", this.syos.settings.get("seatViewIconPath")); this.el.style.top = n.y + "px"; this.el.style.left = n.x + "px" }, fadeOut: function () { this.$el.hide(); syosDispatch.on("map:dragged", this.fadeIn, this) }, fadeIn: function () { this.$el.show("drop", { duration: 150, direction: "down" }); syosDispatch.off("map:dragged", this.fadeIn, this) }, showSeatView: function () { return console.log("SeatViewIcon: showing seat view modal..."), this.modal = new SYOSModal({ Title: "View from Seats", Width: this.syos.settings.get("seatviewWidth"), Height: this.syos.settings.get("seatviewHeight"), Content: "<img src='" + this.model.get("ImageUrl") + "' />" }), this } }); SYOSEmbeddedZoom = SYOSView.extend({ className: "syos-embedded-zoom-wrap", template: Handlebars.templates["embeddedZoom.html"], initialize: function () { this.render() }, events: { "click [data-bb=embeddedZoomIn]": "didClickZoomIn", "click [data-bb=embeddedZoomOut]": "didClickZoomOut" }, getZoomIncrement: function () { var n = this.syos.settings.get("ZoomIncrement"), t = this.syos.settings.get("embeddedZoomModifier"); return n * t }, didClickZoomIn: function () { var n = this.getZoomIncrement(); syosDispatch.trigger("control:smartZoom", -n) }, didClickZoomOut: function () { var n = this.getZoomIncrement(); syosDispatch.trigger("control:smartZoom", n) } }); SYOSPopover = SYOSView.extend({ template: Handlebars.templates["popover.html"], className: "syos-popover", config: { overrideColor: "#3B5998", positionAdjustment: { x: -15, y: -40 } }, initialize: function () { i(this.config).extend(this.options.object); this.seat = this.config.seat; this.circle = this.seat.mapCircle; this.img = this.config.img !== "" ? this.config.img : "/syos/img/cute_ghost.png"; this.bindEvents(this.config.events); this.updateMapCircleColor(this.circle); this.showPopover(); this.positionToCircle(this.circle); syosDispatch.on("display:shouldUpdateStatus", this.updatePopoverPosition, this); syosDispatch.on("levelDidOpen", this.hidePopover, this) }, updateMapCircleColor: function (n) { n.set("fillOverride", this.config.overrideColor) }, bindEvents: function (n) { i(n).each(function (n) { this.$el.on(n.name, n.fn) }, this) }, updatePopoverPosition: function () { this.positionToCircle(this.circle) }, showPopover: function () { this.render(); this.syos.addSubview(this) }, hidePopover: function () { this.syos.removeSubview(this) }, adjustCoordinates: function (n) { var t = i(n).clone(); return t.x += this.config.positionAdjustment.x, t.y += this.config.positionAdjustment.y, t }, positionToCircle: function (n) { var i = this.syos.canvasMap.getPositionForCircle(n), t = this.adjustCoordinates(i); this.$el.css({ top: t.y, left: t.x }) }, viewModel: function () { return i.extend({ img: this.img }) } }) }(); r.Facebook = function () { var n = SYOSView.extend({ defaults: { UserId: 0 }, initialize: function () { this.on("change:UserId", this.loadFacebookData, this); syosDispatch.on("map:didFinishLevelInit", this.loadFacebookData, this); syosDispatch.on("display:shouldUpdateStatus", this.updatePopoverPosition, this) }, overrideColor: "#3B5998", loadFacebookData: function () { this.removeAllPopover(); this.sharedSeats = new SYOSSeatCollection; this.sharedSeats.add(this.syos.activeLevel.seats.first()); this.sharedSeats.add(this.syos.activeLevel.seats.last()); this.checkSeats() }, removeAllPopover: function () { this.sharedSeats && this.sharedSeats.each(function (n) { n.popover && n.popover.hidePopover() }, this) }, updatePopoverPosition: function () { this.sharedSeats && this.sharedSeats.each(function (n) { n.popover.positionToCircle(n.mapCircle) }, this) }, checkSeats: function () { this.sharedSeats && this.sharedSeats.each(function (n) { n.mapCircle.set("fillOverride", this.overrideColor); n.popover = new SYOSPopover; n.popover.positionToCircle(n.mapCircle) }, this) } }); return { Controller: n } }(); window.SYOS = r }(jQuery, Backbone, _); typeof console == "undefined" && (console = {}, console.log = function () { return this }); typeof chrome == "undefined" && (console.info = function () { return this }, console.warn = function () { return this }, console.error = function () { return this }, console.group = function () { return this }, console.groupCollapsed = function () { return this }, console.groupEnd = function () { return this }, console.time = function () { return this }, console.timeEnd = function () { return this }, console.trace = function () { return this }, console.count = function () { return this }, console.dirxml = function () { return this }); console.style = { majorWarn: "color:white; background:rgba(255,0,0,0.6); font-weight:bold;" }; Handlebars.registerHelper("log", function (n) { console.log("Handlebars", n) }); Handlebars.registerHelper("call", function (n, t) { return n.call(t) }); Handlebars.registerHelper("formattedPrice", function (n) { n = isNaN(n) || n === "" || n === null ? 0 : n; return parseFloat(n).toFixed(2) }); Handlebars.registerHelper("paraFormattedPrice", function (n) { n = isNaN(n) || n === "" || n === null ? 0 : n; var t = parseFloat(n), r = t < 0, i = Math.abs(t).toFixed(2); return r ? "($" + i + ")" : "$" + i }); typeof syosOnReady == "undefined" && (syosOnReady = function () { console.log("syosOnReady not overwritten \n") }); syosOnReady();
/*
//# sourceMappingURL=syos.min.js.map
*/